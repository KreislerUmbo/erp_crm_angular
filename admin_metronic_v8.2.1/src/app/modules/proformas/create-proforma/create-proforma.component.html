<div class="d-flex flex-column flex-column-fluid" data-select2-id="select2-data-131-dzps">
    <!--begin::Content-->
    <div id="kt_app_content" class="app-content  flex-column-fluid " data-select2-id="select2-data-kt_app_content">
        <!--begin::Content container-->
        <div id="kt_app_content_container" class="app-container  container-xxl "
            data-select2-id="select2-data-kt_app_content_container">
            <!--begin::Form-->
            <form id="kt_ecommerce_edit_order_form"
                class="form d-flex flex-column flex-lg-row fv-plugins-bootstrap5 fv-plugins-framework"
                data-kt-redirect="/metronic8/demo1/apps/ecommerce/sales/listing.html"
                data-select2-id="select2-data-kt_ecommerce_edit_order_form">
                <!--begin::Aside column-->
                <div class="w-100 flex-lg-row-auto w-lg-300px mb-7 me-7 me-lg-10"
                    data-select2-id="select2-data-130-y9wa">

                    <!--begin::Order details-->
                    <div class="card card-flush py-4" data-select2-id="select2-data-129-w2zd">
                        <!--begin::Card header-->
                        <div class="card-header">
                            <div class="card-title">
                                <h2>Proforma</h2>
                            </div>
                        </div>
                        <!--end::Card header-->

                        <!--begin::Card body-->
                        <div class="card-body pt-0" data-select2-id="select2-data-128-9mmu">
                            <div class="d-flex flex-column gap-10" data-select2-id="select2-data-127-2qsf">
                                <!--begin::Input group-->
                                <div class="fv-row">
                                    <!--begin::Label-->
                                    <label class="form-label">Fecha:</label>
                                    <!--end::Label-->

                                    <!--begin::Auto-generated ID-->
                                    <div class="fw-bold fs-3">2024/11/26</div>
                                    <!--end::Input-->
                                </div>
                                <!--end::Input group-->
                                <div class="fv-row mt-4">
                                    <select class="form-control form-select-solid fw-bolder" name="categorie"
                                        placeholder="Selec. Metodo de pago">
                                        <option value="">Selec. Metodo de pago</option>
                                    </select>
                                </div>

                                <div class="fv-row">
                                    <select class="form-control form-select-solid fw-bolder" name="categorie"
                                        placeholder="Selec. Banco">
                                        <option value="">Selec. Banco</option>
                                    </select>
                                </div>

                                <div class="fv-row">
                                    <!--begin::Label-->
                                    <label class="required form-label">Importe de Pago</label>
                                    <!--end::Label-->

                                    <!--begin::Input-->
                                    <input type="numbers" [(ngModel)]="deuda" name="deuda" class="form-control mb-2"
                                        placeholder="Importe de Pago" value="">
                                    <!--end::Input-->
                                </div>

                                <div class="fv-row">
                                    <label for="formFile" class="form-label">Comprobante</label>
                                    <input class="form-control" type="file"
                                        accept=".jpeg, .bmp, .jpg, .png, .gif, .webp" id="formFile">
                                </div>
                                <div class="fv-row">
                                    <button class="btn btn-md btn-primary">Agregar Pago</button>
                                </div>
                            </div>
                        </div>
                        <!--end::Card header-->
                    </div>
                    <!--end::Order details-->
                </div>
                <!--end::Aside column-->
                <span class="spinner-border spinner-border-sm align-middle ms-2" *ngIf="isLoading$ | async"></span>
                <!--begin::Main column-->
                <div class="d-flex flex-column flex-lg-row-fluid gap-7 gap-lg-10">

                    <!--begin::Order details-->
                    <div class="card card-flush py-4">
                        <!--begin::Card header-->
                        <div class="card-header" style="display: block;">

                            <div class="row justify-content-between">
                                <div class="col-6 d-flex align-items-center">
                                    <h2 class="d-flex align-items-center"><i class="ki-duotone ki-user fs-2"><span
                                                class="path1"></span><span class="path2"></span></i>Cliente :</h2>
                                    <small class="mx-2">{{CLIENT_SELECTED ? CLIENT_SELECTED.client_segment.name : 'No ha
                                        seleccionado un cliente'}}</small>
                                </div>
                                <div class="col-5">
                                    <button class="btn btn-icon btn-primary" (click)="searchClients()"
                                        placement="top-start" ngbTooltip="Buscar Cliente">
                                        <i class="ki-solid ki-parcel-tracking fs-2"><span class="path3"></span><span
                                                class="path3"></span></i>
                                    </button>
                                    <button class="btn btn-icon btn-danger mx-1" (click)="createClientPerson()"
                                        placement="top-start" ngbTooltip="Crear Nuevo Cliente Tipo Persona">
                                        <i class="ki-solid ki-user-edit fs-2"><span class="path2"></span><span
                                                class="path2"></span></i>
                                    </button>
                                    <button class="btn btn-icon btn-warning" (click)="createClientCompany()"
                                        placement="top-start" ngbTooltip="Crear Nuevo Cliente Tipo Empresa">
                                        <i class="ki-solid ki-truck fs-2"><span class="path2"></span><span
                                                class="path2"></span></i>
                                    </button>
                                    <button class="btn btn-icon btn-dark mx-1" (click)="resetClient()"
                                        placement="top-start" ngbTooltip="Limpiar Campos">
                                        <i class="ki-solid ki-eraser fs-2"><span class="path2"></span><span
                                                class="path2"></span></i>
                                    </button>
                                </div>
                            </div>


                        </div>
                        <!--end::Card header-->

                        <!--begin::Card body-->
                        <div class="card-body pt-0">
                            <div class="row">
                                <div class="col-4">
                                    <!--begin::Label-->
                                    <label class="required form-label">N° de Documento Ident</label>
                                    <!--end::Label-->

                                    <!--begin::Input-->
                                    <input type="text" (keyup.enter)="searchClients()" [(ngModel)]="nro_document"
                                        name="nro_document" class="form-control mb-2" placeholder="N° DOCUMENTO"
                                        value="">
                                    <!--end::Input-->
                                </div>
                                <div class="col-4">
                                    <!--begin::Label-->
                                    <label class="required form-label">Nombre del Cliente</label>
                                    <!--end::Label-->

                                    <!--begin::Input-->
                                    <input type="text" (keyup.enter)="searchClients()" [(ngModel)]="full_name"
                                        name="full_name" class="form-control mb-2" placeholder="NOMBRE DEL CLIENTE"
                                        value="">
                                    <!--end::Input-->
                                </div>
                                <div class="col-4">
                                    <!--begin::Label-->
                                    <label class="required form-label">N° Teléfono</label>
                                    <!--end::Label-->

                                    <!--begin::Input-->
                                    <input type="text" (keyup.enter)="searchClients()" [(ngModel)]="phone" name="phone"
                                        class="form-control mb-2" placeholder="N° TELEFONO" value="">
                                    <!--end::Input-->
                                </div>
                            </div>


                        </div>
                        <!--end::Card header-->
                    </div>
                    <!--end::Order details-->

                    <!--begin::Order details-->
                    <div class="card card-flush py-4">
                        <!--begin::Card header-->
                        <div class="card-header" style="display: block;">
                            <div class="row justify-content-between">
                                <div class="col-8 d-flex align-items-center">
                                    <h2 class="d-flex align-items-center">
                                        <i class="ki-duotone ki-delivery-door text-gray-900 fs-2tx"><span
                                                class="path1"></span><span class="path2"></span><span
                                                class="path3"></span><span class="path4"></span></i>

                                        Products :
                                    </h2>
                                    <small class="mx-2">{{PRODUCT_SELECTED ? PRODUCT_SELECTED.product_categorie.name :
                                        'NO hay producto seleccionado'}}</small>
                                </div>
                                <div class="col-4">

                                    <button class="btn btn-icon btn-primary" (click)="searchProducts()"
                                        placement="top-start" ngbTooltip="Buscar Producto">
                                        <i class="ki-solid ki-parcel-tracking fs-2"><span class="path2"></span><span
                                                class="path2"></span></i>
                                    </button>

                                    <button class="btn btn-icon btn-dark mx-1" placement="top-start" (click)="resetProduct()"
                                        ngbTooltip="Limpiar">
                                        <i class="ki-solid ki-eraser fs-2"><span class="path2"></span><span
                                                class="path2"></span></i>
                                    </button>

                                    <button class="btn btn-icon btn-success mx-1" placement="top-start" (click)="addProduct()"
                                        ngbTooltip="Agregar">
                                        <i class="ki-duotone ki-plus-square fs-2"><span class="path1"></span><span
                                                class="path3"></span></i>
                                    </button>

                                </div>

                            </div>


                        </div>
                        <!--end::Card header-->

                        <!--begin::Card body-->
                        <div class="card-body pt-0">
                            <div class="d-flex flex-column gap-10">

                                <div id="kt_ecommerce_edit_order_product_table_wrapper"
                                    class="dt-container dt-bootstrap5 dt-empty-footer">

                                    <div id="" class="row">
                                        <div class="col-6">
                                            <small> Producto</small>
                                            <div class="d-flex align-items-center position-relative mb-n7 ">
                                                <i class="ki-duotone ki-magnifier fs-3 position-absolute ms-4"><span
                                                        class="path1"></span><span class="path2"></span></i> <input
                                                    type="text" data-kt-ecommerce-edit-order-filter="search"
                                                    name="search_product" [(ngModel)]="search_product"
                                                    (keyup.enter)="searchProducts()"
                                                    class="form-control form-control-solid  ps-12"
                                                    placeholder="Buscar Producto">
                                            </div>
                                        </div>
                                        <div class="col-3">
                                            <small>Cantidad</small>
                                            <!--begin::Input-->
                                            <input type="number" [(ngModel)]="cantidad" name="cantidad"
                                                class="form-control mb-2" placeholder="Cantidad" value="">
                                            <!--end::Input-->

                                        </div>

                                        <div class="col-3">
                                            <small>Precio del Producto</small>
                                            <!--begin::Input-->
                                            <input type="number" [(ngModel)]="price" name="price"
                                                class="form-control mb-2" placeholder="Precio" value="">
                                            <!--end::Input-->

                                        </div>
                                        <div class="col-3">
                                            <select class="form-control form-select-solid fw-bolder"
                                                name="unidad_product" [(ngModel)]="unidad_product"
                                                placeholder="Selec. Unidad" (change)="changeUnitProduct($event)"
                                                *ngIf="!loadUnidad">

                                                <option value="">Selec. Unidad</option>

                                                <ng-container *ngIf="PRODUCT_SELECTED">
                                                    <ng-container *ngFor="let unit of PRODUCT_SELECTED.units">
                                                        <option [value]="unit.id">{{unit.name}}</option>
                                                    </ng-container>
                                                </ng-container>
                                            </select>
                                        </div>

                                        <div class="col-3">
                                            <select class="form-control form-select-solid fw-bolder"
                                                name="almacen_product" [(ngModel)]="almacen_product"
                                                placeholder="Seleccione un Almacen">
                                                <option value="">Selec. Almacen</option>
                                                <ng-container *ngFor="let almacen of warehouses_product">
                                                    <option [value]="almacen.id">{{almacen.warehouse.name}}
                                                        ({{almacen.quantity}})</option>
                                                </ng-container>
                                            </select>
                                        </div>
                                        <div class="col-6">
                                            <div class="d-flex flex-column mb-8">
                                                <label class="fs-6 fw-semibold mb-2">Nota</label>
                                                <textarea class="form-control form-control-solid" rows="3   "
                                                    name="description_product" placeholder="Nota"></textarea>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <span *ngIf="unidad_product && warehouses_product.length==0"
                                                class="text-danger">No hay de esa unidad disponible en ninguna
                                                sucursal</span>
                                            <br>
                                            <span
                                                *ngIf="unidad_product && warehouses_product.length > 0 && exist_warehouse.length==0"
                                                class="text-danger">No hay de esa unidad disponible en nuestra
                                                sucursal</span>
                                        </div>
                                        <div class="col-4 ngIf=PRODUCT_SELECTED && PRODUCT_SELECTED.is_descount==2">
                                            <small>Descuento del Producto</small>
                                            <!--begin::Input    (keyup)="verifiedDiscount()"-->
                                            <input type="number" #discount [(ngModel)]="amount_discount"
                                                name="amount_discount" class="form-control mb-2" placeholder="Descuento"
                                                value="">
                                            <!--end::Input-->

                                        </div>
                                    </div>
                                </div>

                                <div class="separator"></div>

                                <div>
                                    <div class="fw-bold fs-4">
                                        Costo Total :
                                        <span id="kt_ecommerce_edit_order_total_price" *ngIf="PRODUCT_SELECTED">
                                            {{(((price - amount_discount) +
                                            (price-amount_discount)*(PRODUCT_SELECTED.importe_iva*0.01))*cantidad)}}
                                        </span>
                                        <span id="kt_ecommerce_edit_order_total_price" *ngIf="!PRODUCT_SELECTED">
                                            0.00
                                        </span>PEN
                                        <br>
                                        Subtotal: {{price - amount_discount}} PEN
                                        <ng-container *ngIf="PRODUCT_SELECTED">
                                            <br>
                                            Impuesto : {{(price - amount_discount)*(PRODUCT_SELECTED.importe_iva*0.01)}}
                                        </ng-container>
                                        <ng-container *ngIf="!PRODUCT_SELECTED">
                                            <br>
                                            Impuesto : 0 PEN
                                        </ng-container>

                                    </div>
                                </div>

                            </div>
                        </div>
                        <!--end::Card header-->
                    </div>
                    <!--end::Order details-->
                    <!--begin::Order details-->
                    <div class="card card-flush py-4">
                        <!--begin::Card header-->
                        <div class="card-header" style="display: block;">
                            <div class="row justify-content-between">
                                <div class="col-7">
                                    <h2 class="d-flex align-items-center">
                                        <i class="ki-duotone ki-questionnaire-tablet text-gray-900 fs-2tx"><span
                                                class="path1"></span><span class="path2"></span><span
                                                class="path3"></span><span class="path4"></span><span
                                                class="path5"></span></i>
                                        Detallado de la Proforma :
                                    </h2>
                                </div>
                                <div class="col-3">

                                </div>
                            </div>
                        </div>
                        <!--end::Card header-->

                        <!--begin::Card body-->
                        <div class="card-body pt-0">
                            <div class="row">
                                <div class="col-12">
                                    <div class="table-responsive">
                                        <!--begin::Table-->
                                        <table
                                            class="table table-row-bordered table-row-gray-100 align-middle gs-0 gy-3">
                                            <!--begin::Table head-->
                                            <thead>
                                                <tr class="fw-bold text-muted">
                                                    <th class="min-w-150px">Producto</th>
                                                    <th class="min-w-140px">Unidad</th>
                                                    <th class="min-w-120px">Cant.</th>
                                                    <th class="min-w-120px">Precio Unit</th>
                                                    <th class="min-w-120px">SubTotal</th> 
                                                    <th class="min-w-120px">Total</th>
                                                    <th class="min-w-100px text-end">Actions</th>
                                                </tr>
                                            </thead>
                                            <!--end::Table head-->

                                            <!--begin::Table body-->
                                            <tbody>
                                                <ng-container *ngFor="let DETAIL_PROFOR of DETAIL_PROFORMAS; let i=index">
                                                <tr>
                                                    <td>
                                                        <a href="#" onclick="return false"
                                                            class="text-gray-900 fw-bold text-hover-primary fs-6">
                                                           {{DETAIL_PROFOR.product.title}}</a>
                                                    </td>

                                                    <td>
<!--                                                         <a href="#"  onclick="return false"
                                                            class="text-gray-900 fw-bold text-hover-primary d-block mb-1 fs-6">UNIDAD: </a> -->
                                                        <span
                                                            class="text-muted fw-semibold text-muted d-block fs-7">{{DETAIL_PROFOR.unit.name}}</span>
                                                    </td>

                                                    <td>
                                                        <a href="#"  onclick="return false"
                                                            class="text-gray-900 fw-bold text-hover-primary d-block mb-1 fs-6">{{DETAIL_PROFOR.cantidad}}</a>
                                                    </td>

                                                    <td>
                                                        <a href="#" onclick="return false"
                                                            class="text-gray-900 fw-bold text-hover-primary d-block mb-1 fs-6">{{DETAIL_PROFOR.price_unit}} PEN
                                                        </a>
<!--                                                         <span class="text-muted fw-semibold text-muted d-block fs-7">
                                                            </span> -->
                                                    </td>

                                                    <a href="#" onclick="return false"
                                                    class="text-gray-900 fw-bold text-hover-primary d-block mb-1 fs-6">{{DETAIL_PROFOR.subtotal}} PEN
                                                </a>
                                         
                                                    <td>
                                                        <span class="text-gray-900 fw-bold text-hover-primary d-block mb-1 fs-6"  style="text-wrap: nowrap;">{{DETAIL_PROFOR.total}} PEN</span>
                                                    </td>

                                                    <td class="text-end">
<!--                                                         <a href="#"
                                                            class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1">
                                                            <i class="ki-duotone ki-switch fs-2"><span
                                                                    class="path1"></span><span class="path2"></span></i>
                                                        </a> -->

                                                        <a href="#" onclick="return false;" (click)="editProduct(DETAIL_PROFOR,i)"
                                                            class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1">
                                                            <i class="ki-duotone ki-pencil fs-2"><span
                                                                    class="path1"></span><span class="path2"></span></i>
                                                        </a>

                                                        <a href="#" onclick="return false;" (click)="deleteProduct(DETAIL_PROFOR,i)"
                                                            class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm">
                                                            <i class="ki-duotone ki-trash fs-2"><span
                                                                    class="path1"></span><span
                                                                    class="path2"></span><span
                                                                    class="path3"></span><span
                                                                    class="path4"></span><span class="path5"></span></i>
                                                        </a>
                                                    </td>
                                                </tr>
                                            </ng-container>
                                            </tbody>
                                            <!--end::Table body-->
                                        </table>
                                        <!--end::Table-->
                                    </div>
                                </div>
                            </div>
                            <div class="separator"></div>

                            <div>
                                <div class="fw-bold fs-4 align-items-end">
                                     Total :
                                    <span id="kt_ecommerce_edit_order_total_price">
                                       {{TOTAL_PROFORMA}}
                                    </span>PEN
                                    <br>
                                        Impuesto : {{TOTAL_IMPUESTO_PROFORMA}}  PEN
                                        Deuda: {{DEUDA_PROFORMA}} PEN
                                        Pagado: {{PAID_OUT_PROFORMA}} PEN

                                </div>
                            </div>
                        </div>
                    </div>
                    <!--begin::Order details-->
                    <div class="card card-flush py-4">
                        <!--begin::Card header-->
                        <div class="card-header" style="display: block;">
                            <div class="row justify-content-between">
                                <div class="col-6">
                                    <h2 class="d-flex align-items-center">
                                        <i class="ki-duotone ki-delivery-geolocation text-gray-900 fs-2tx"><span
                                                class="path1"></span><span class="path2"></span><span
                                                class="path3"></span><span class="path4"></span><span
                                                class="path5"></span></i>
                                        Lugar de Enrega :
                                    </h2>
                                </div>
                                <div class="col-3">
                                    <button class="btn btn-icon btn-success" placement="top-start" ngbTooltip="Buscar">
                                        <i class="ki-duotone ki-people fs-2"><span class="path1"></span><span
                                                class="path2"></span></i>
                                    </button>

                                    <button class="btn btn-icon btn-dark mx-1" placement="top-start"
                                        ngbTooltip="Limpiar">
                                        <i class="ki-duotone ki-loading fs-2"><span class="path1"></span><span
                                                class="path2"></span></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <!--end::Card header-->

                        <!--begin::Card body-->
                        <div class="card-body pt-0">
                            <div class="row">
                                <div class="col-3">
                                    <select class="form-control form-select-solid fw-bolder" name="categorie"
                                        placeholder="Selec. Lugar Entrega">
                                        <option value="">Lugar de Entrega</option>
                                    </select>
                                </div>

                                <div class="col-5">
                                    <textarea class="form-control form-control-solid" rows="3" name="address"
                                        placeholder="Direccion Completa"></textarea>
                                </div>
                                <div class="col-4">
                                    <input type="date" class="form-control form-control-lg form-control-solid" />
                                    <small>Fecha de Entrega</small>
                                </div>
                                <div class="col-3">
                                    <!--begin::Label-->
                                    <label class="required fw-bold fs-6 mb-2">Región (*) </label>
                                    <!--end::Label-->
                                    <select class="form-control form-select-solid fw-bolder" name="ubigeo_region"
                                        placeholder="Selec. Region" [(ngModel)]="ubigeo_region"
                                        (change)="changeRegion($event)">

                                        <option value="">Ninguno</option>
                                        <ng-container *ngFor="let REGION  of REGIONES">
                                            <option [value]="REGION.id">{{REGION.name}}</option>
                                        </ng-container>

                                    </select>
                                </div>
                                <div class="col-3">
                                    <!--begin::Label-->
                                    <label class="required fw-bold fs-6 mb-2">Provincias </label>
                                    <!--end::Label-->
                                    <select class="form-control form-select-solid fw-bolder" name="ubigeo_provincia"
                                        placeholder="Selec. Provincias" [(ngModel)]="ubigeo_provincia"
                                        (change)="changeProvincia($event)">

                                        <option value="">Ninguno</option>
                                        <ng-container *ngFor="let PROVINCIA of PROVINCIA_SELECTEDS">
                                            <option [value]="PROVINCIA.id">{{PROVINCIA.name}}</option>
                                        </ng-container>
                                    </select>
                                </div>
                                <div class="col-3">
                                    <!--begin::Label-->
                                    <label class="required fw-bold fs-6 mb-2">Distritos </label>
                                    <!--end::Label-->
                                    <select class="form-control form-select-solid fw-bolder" name="ubigeo_distrito"
                                        placeholder="Selec. Distritos" [(ngModel)]="ubigeo_distrito">
                                        <option value="">Todos</option>
                                        <ng-container *ngFor="let DISTRITO of DISTRITO_SELECTEDS">
                                            <option [value]="DISTRITO.id">{{DISTRITO.name}}</option>
                                        </ng-container>
                                    </select>
                                </div>

                                <div class="col-3">
                                    <input type="text" [(ngModel)]="agencia" name="agencia" class="form-control mb-2"
                                        placeholder="Agencia de Envio" value="">
                                </div>

                                <div class="col-3">
                                    <input type="text" [(ngModel)]="full_name_encargado" name="full_name_encargado"
                                        class="form-control mb-2" placeholder="Nombre del Encargado" value="">
                                </div>
                                <div class="col-3">
                                    <input type="number" [(ngModel)]="documento_encargado" name="documento_encargado"
                                        class="form-control mb-2" placeholder="Documento del Encargado" value="">
                                </div>
                                <div class="col-3">
                                    <input type="tel" [(ngModel)]="telefono_encargado" name="telefono_encargado"
                                        class="form-control mb-2" placeholder="Telefono del Encargado" value="">
                                </div>


                            </div>
                        </div>
                        <!--end::Card body-->
                    </div>
                    <!--end::Order details-->
                    <div class="d-flex justify-content-end">
                        <!--begin::Button-->
                        <button type="submit" id="kt_ecommerce_edit_order_submit" class="btn btn-primary">
                            <span class="indicator-label">
                                Save Changes
                            </span>
                            <span class="indicator-progress">
                                Please wait... <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                            </span>
                        </button>
                        <!--end::Button-->
                    </div>
                </div>
                <!--end::Main column-->
            </form>
            <!--end::Form-->
        </div>
        <!--end::Content container-->
    </div>
    <!--end::Content-->

</div>